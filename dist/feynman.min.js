/*! feynman 2014-04-25 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=function(){var a=function(a,b){this.id=a,this.pos=b,this.x=0,this.y=0};return a.prototype.draw=function(){},a}()},{}],2:[function(a,b){var c=a("./propagators/Electron"),d=a("./propagators/Quark"),e=a("./propagators/Gluon"),f=a("./propagators/Photon");b.exports={getParticle:function(a){if(void 0===a)throw new Error("Missing data argument!");return"e-"===a.type?new c(a.id,a.color,a.length):"e+"===a.type?new c(a.id,a.color,a.length,!0):"q"===a.type?new d(a.id,a.color,a.length):"aq"===a.type?new d(a.id,a.color,a.length,!0):"g"===a.type?new e(a.id,a.color,a.length):"ph"===a.type?new f(a.id,a.color,a.length):void 0}}},{"./propagators/Electron":13,"./propagators/Gluon":14,"./propagators/Photon":15,"./propagators/Quark":16}],3:[function(a,b){b.exports=function(){var a=function(){return this.title="Feynman",this.layout="time-space",this.width=100,this.height=100,this.showAxes=!0,this.propagators=[],this.vertices=[],this.cPoints={left:[],right:[],top:[],bottom:[]},this.levels=1,this};a.prototype.getVertexById=function(a){var b=void 0;return this.vertices.forEach(function(c){c&&c.id===a&&(b=c)}),b},a.prototype.getVerticesByLevel=function(a){var b=[];return this.vertices.forEach(function(c){c&&c.level===a&&b.push(c)}),b},a.prototype.getControlPointById=function(a){var b=void 0;for(var c in this.cPoints)this.cPoints.hasOwnProperty(c)&&this.cPoints[c].forEach(function(c){c.id===a&&(b=c)});return b},a.prototype.setCanvas=function(a){return this.canvas=a,this.canvas.size(this.width,this.height),f(this),g(this),this},a.prototype.draw=function(){return console.log(this.vertices),b(this),c(this),d(this),this};var b=function(a){a.canvas.text(a.title).font({family:"Georgia",size:14,style:"italic",anchor:"left"})},c=function(a){a.vertices.forEach(function(b){b.draw(a)})},d=function(a){a.propagators.forEach(function(b){var c=e(b,a);b.draw(a.canvas,c.end,c.start)})},e=function(a){var b=a.from,c=a.to;return{start:b,end:c}},f=function(a){var b=1===a.cPoints.left.length?2:a.cPoints.left.length,c=.3*a.height/2,d=.7*a.height/(b-1),e=0;a.cPoints.left.forEach(function(a){a.y=e*d+c,e++}),b=1===a.cPoints.right.length?2:a.cPoints.right.length,c=.3*a.height/2,d=.7*a.height/(b-1),e=0,a.cPoints.right.forEach(function(b){b.x=a.width,b.y=e*d+c,e++})},g=function(a){for(var b=.3*a.height/2,c=1===a.levels?2:a.levels,d=.7*a.height/c,e=1;e<=a.levels;e++){console.log(e);var f=a.getVerticesByLevel(e),g=a.width/(f.length+1),h=1;f.forEach(function(a){a.x=h*g,a.y=d*a.level+b,h++})}};return a}()},{}],4:[function(a,b){b.exports=function(){var a=function(a){return this.id=a,this.visible=!1,this.level=1,this.x=0,this.y=0,this};return a.prototype.draw=function(a){if(this.visible){var b=a.canvas.group();b.circle(8).fill({color:"#000"}).translate(this.x-4,this.y-4)}},a}()},{}],5:[function(a,b){var c=Math.PI,d=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.exports={normalizePathString:function(){for(var a,b="",c=0,d=arguments.length;d>c;c++)a=arguments[c],b+=" "+("number"!=typeof a?a:a.toFixed(3).replace(/(.\d*?)0+$/,"$1").replace(/\.$/,""));var e=b.trim();return e.replace(/ ?, ?/g,",")},getCoordinatesInBezier:function(a,b,c,d,e,f){var g=Math.atan2(d-b,c-a);return this.normalizePathString(e*Math.cos(g)-f*Math.sin(g)+a,",",e*Math.sin(g)+f*Math.cos(g)+b)},line:function(a,b,c){for(var e=["M"],f=Math.floor(c/b),g=c-b*f+.1,h=0;f>=h;h++)for(var i,j=0,k=a.length;k>j;j++)if(i=a[j],d(i)){if(!(f>h||i[0]<g))break;e.push(this.normalizePathString(i[0]+b*h,",",i[1]))}else e.push(i);return e.join(" ").replace(/\s[A-Z][^A-Z]*$/,"")},arc:function(a,b,e,f){for(var g=2,h=.25*Math.max(g,2),i=Math.acos(-.5/h),j=-2*Math.asin(e/(h*f)),k=[],l=["M","0,0"],m=0;(c-2*i)/j>=m;m++)k.push([f*(h*Math.cos(j*m+i)+.5),f*(h*Math.sin(j*m+i)-Math.sqrt(h*h-.25))]);for(var n,o=0,p=k.length-1;p>o;o++){n="photon"===a?b[o%2]:b;for(var q,r=0,s=n.length;s>r;r++)q=n[r],l.push(d(q)?this.getCoordinatesInBezier(k[o][0],k[o][1],k[o+1][0],k[o+1][1],q[0],q[1]):q)}return l.join(" ").replace(/\s[A-Z]$/,"")},loop:function(a,b,e,f){for(var g=!0,h=2*Math.asin(2*e/f),i=2*c/h,j=[],k=g?-.5:.5,l=["M","gluon"===a?k+",0":"0,"+k],m=-.1,n=f;Math.floor(i)%4||i-Math.floor(i)>.1;m+=.001)f=(1+m)*n,h=2*Math.asin(2*e/f),i=2*c/h;for(var o=0;i>=o;o++){var p=.5*f*(1-Math.cos(h*o)),q=.5*f*Math.sin(h*o);j.push([p,q])}for(var r,s=0,t=j.length-1;t>s;s++){r="photon"===a?b[s%2]:b;for(var u,v=0,w=r.length;w>v;v++)u=r[v],l.push(d(u)?this.getCoordinatesInBezier(j[s][0],j[s][1],j[s+1][0],j[s+1][1],u[0],u[1]):u)}return l.join(" ").replace(/\s[A-Z]$/,"")+" Z"}}},{}],6:[function(a,b){b.exports={getAngle:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.atan2(d,c)*(180/Math.PI)},getDistance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)}}},{}],7:[function(a,b){var c={}.hasOwnProperty;b.exports={__extends:function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a}}},{}],8:[function(a,b){var c=a("./parsers/ParserFactory");b.exports=function(){var a=function(){return this};return a.prototype.draw=function(a,b){if("undefined"==typeof a)throw new Error("Missing canvas#id argument!");if("undefined"==typeof b)throw new Error("Missing data argument!");var d=new SVG(a),e=c.getParser(b.lang),f=e.parse(b);return f.setCanvas(d).draw(),this},window.Feynman=a,a}()},{"./parsers/ParserFactory":10}],9:[function(a,b){var c=a("./../Stage"),d=a("./../ParticleGenerator"),e=a("./../ControlPoint"),f=a("./../Vertex");b.exports=function(){var a=new c,b=function(){return this};b.prototype.parse=function(b){if(void 0===b)throw new Error("Missing data argument!");return a=new c,a.title=b.title,a.width=b.width,a.height=b.height,b.diagram.forEach(function(a){g(a)},this),a};var g=function(a){var b=a.match(/\w+/g)[0],c=p(o(a.match(/(\{(\w+,?)+\})/g)));void 0!==b&&void 0!==u[b]&&u[b](c)},h=function(b){for(var c=0,d=s(b[1]);b[1][c+1];){var e=b[1][c],f=b[1][c+1],g=t(e,d),h=t(f,d);if(!g||!h)throw new Error("Invalid Vertex or Control Point");var i="p"+a.propagators.length+1,j=q(b[0][0],i);j.from=g,j.to=h,a.propagators.push(j),c++}d&&(a.levels+=1)},i=function(b,c){c[0].forEach(function(c){if(!a.getControlPointById(c)){var d=new e(c,b);a.cPoints[b].push(d)}})},j=function(a){i("right",a)},k=function(a){i("left",a)},l=function(a){i("top",a)},m=function(a){i("bottom",a)},n=function(b){b[0].forEach(function(b){var c=a.getVertexById(b);c.visible=!0})},o=function(a){var b=/\{|\}/g;return a.map(function(a){return a.replace(b,"")})},p=function(a){var b=[];return a.forEach(function(a){var c=a.split(",");b.push(c)}),b},q=function(a,b){var c;switch(a){case"electron":c=d.getParticle({id:b,type:"e-"});break;case"pozitron":c=d.getParticle({id:b,type:"e+"});break;case"quark":c=d.getParticle({id:b,type:"q"});break;case"photon":c=d.getParticle({id:b,type:"ph"});break;case"gluon":c=d.getParticle({id:b,type:"g"});break;case"antifermion":c=d.getParticle({id:b,type:"e+"});break;default:c=d.getParticle({id:b,type:"e-"})}return c},r=function(a){return"v"===a[0]},s=function(b){var c=a.getControlPointById(b[0]),d=a.getControlPointById(b[b.length-1]);return c&&d&&c.pos!==d.pos},t=function(b,c){var d;return r(b)?(d=a.getVertexById(b)?a.getVertexById(b):new f(b),c&&(d.level=a.levels),a.getVertexById(b)||a.vertices.push(d)):d=a.getControlPointById(b),d},u={fmf:h,fmfright:j,fmfleft:k,fmftop:l,fmfbottom:m,fmfdot:n};return b}()},{"./../ControlPoint":1,"./../ParticleGenerator":2,"./../Stage":3,"./../Vertex":4}],10:[function(a,b){var c=a("./StandardParser"),d=a("./LatexParser");b.exports={getParser:function(a){return"latex"===a?new d:new c}}},{"./LatexParser":9,"./StandardParser":11}],11:[function(a,b){{var c=a("./../Stage");a("./../ParticleGenerator")}b.exports=function(){var a=function(){return this};a.prototype.parse=function(a){if(void 0===a)throw new Error("Missing data argument!");var g=new c;return b(g,a.title),d(g,a.layout),e(g,a.width,a.height),f(g,a.showAxes),g};var b=function(a,b){void 0!==b&&(a.title=b)},d=function(a,b){void 0!==b&&(a.layout=b)},e=function(a,b,c){void 0!==b&&(a.width=b),void 0!==c&&(a.height=c)},f=function(a,b){void 0!==b&&(a.showAxes=b)};return a}()},{"./../ParticleGenerator":2,"./../Stage":3}],12:[function(a,b){var c=a("./../helpers/Coordinates");b.exports=function(){var a="#000",b=109,d=function(c,d,e){if(void 0===c)throw new Error("Missing id argument!");return this.id=c,this.color=d||a,this.length=e||b,this.from=null,this.to=null,this.x=0,this.y=0,this};return d.prototype.draw=function(){throw new Error("Cannot call abstract method!")},d.prototype.getPath=function(){throw new Error("Cannot call abstract method!")},d.prototype.getPosition=function(a,b){var d=b?b:this,e=a?a:this,f=a?1:-1,g=f*c.getAngle(d,e),h=c.getDistance(d,e);return{x:b?d.x:a.x,y:b?d.y:a.y,r:g,l:h}},d}()},{"./../helpers/Coordinates":6}],13:[function(a,b){{var c=a("./../helpers/Klass"),d=a("./AbstractParticle"),e=a("./../helpers/Bezier");a("./../helpers/Coordinates")}b.exports=function(a){function b(a,c,d,e){b.__super__.constructor.apply(this,[a,c,d]),this.anti=e||!1}c.__extends(b,a),b.prototype.draw=function(a,b,c){var e=this.getPosition(b,c);this.length=e.l;var f=a.group();d(f,this.length,this.color,this.anti),f.path(this.getPath("line")).fill("none").stroke({width:2,color:this.color}),f.transform({cx:e.x,cy:e.y,rotation:e.r,x:e.x,y:e.y})},b.prototype.getPath=function(a){var b=[[1,1],[2,1]],c=1;switch(a){case"line":return e.line(b,c,this.length);case"arc":return e.arc("electron",b,c,this.length);case"loop":return e.loop("electron",b,c,this.length);default:return e.line(b,c,this.length)}};var d=function(a,b,c,d){var e=d?-1:1,f=b/2+7*e,g=0,h=b/2-7*e,i=4,j=b/2-7*e,k=-4,l=""+f+","+g+" "+h+","+i+" "+j+","+k;a.polygon(l).fill(c)};return b}(d)},{"./../helpers/Bezier":5,"./../helpers/Coordinates":6,"./../helpers/Klass":7,"./AbstractParticle":12}],14:[function(a,b){var c=a("./../helpers/Klass"),d=a("./AbstractParticle"),e=a("./../helpers/Bezier");b.exports=function(a){function b(a,c,d){b.__super__.constructor.apply(this,[a,c||"#009933",d||96])}return c.__extends(b,a),b.prototype.draw=function(a,b,c){var d=this.getPosition(b,c);this.length=d.l;var e=this.getPath("line");a.path(e,!0).transform({cx:d.x,cy:d.y,rotation:d.r,x:d.x,y:d.y}).fill("none").stroke({width:1,color:this.color})},b.prototype.getPath=function(a){var b={width:15,height:15,factor:.75,percent:.6,scale:1.15},c=.55191502,d=b.height*b.factor,f=b.width*b.percent,g=b.height*(b.factor-.5),h=b.width*(1-b.percent),i=!1,j=i?[[0,0],"A "+d+" "+f,0,0,1,[d,f],"A "+g+" "+h,0,1,1,[d-2*g,f],"A "+d+" "+f,0,0,1]:[[0,0],"A "+d+" "+f,0,0,0,[d,-f],"A "+g+" "+h,0,1,0,[d-2*g,-f],"A "+d+" "+f,0,0,0];d=i?d:b.scale*d;var k=d/Math.pow(this.length,.6),l=i?["C",[c*d,k],[d,f-c*f],[d,f],"C",[d,f+c*h],[d-g+c*g,f+h],[d-g,f+h],"S",[d-2*g,f+c*h],[d-2*g,f],"C",[d-2*g,f-c*f],[2*(d-g)-c*d,0],[2*(d-g),-k]]:["C",[c*d,k],[d,-f+c*f],[d,-f],"C",[d,-f-c*h],[d-g+c*g,-f-h],[d-g,-f-h],"S",[d-2*g,-f-c*h],[d-2*g,-f],"C",[d-2*g,-f+c*f],[2*(d-g)-c*d,0],[2*(d-g),-k]];switch(a){case"line":return e.line(j,b.height,this.length);case"arc":return e.arc("gluon",l,d-g,this.length);case"loop":return e.loop("gluon",l,d-g,this.length);default:return e.line(j,b.height,this.length)}},b}(d)},{"./../helpers/Bezier":5,"./../helpers/Klass":7,"./AbstractParticle":12}],15:[function(a,b){var c=a("./../helpers/Klass"),d=a("./AbstractParticle"),e=a("./../helpers/Bezier");b.exports=function(a){function b(a,c,d){b.__super__.constructor.apply(this,[a,c||"#0066FF",d||109])}return c.__extends(b,a),b.prototype.draw=function(a,b,c){var d=this.getPosition(b,c);this.length=d.l;var e=this.getPath("line");a.path(e,!0).transform({cx:d.x,cy:d.y,rotation:d.r,x:d.x,y:d.y}).fill("none").stroke({width:2,color:this.color})},b.prototype.getPath=function(a){var b=Math.PI,c=.51128733,d=5,f=.5*c*d,g=5,h=2*g/b,i=c*g/b,j=!1,k=j?[[0,0],"C",[i,-f],[h,-d],[g,-d],"S",[2*g-i,-f],[2*g,0],"S",[2*g+h,d],[3*g,d],"S",[4*g-i,f]]:[[0,0],"C",[i,f],[h,d],[g,d],"S",[2*g-i,f],[2*g,0],"S",[2*g+h,-d],[3*g,-d],"S",[4*g-i,-f]],l=j?[["C",[i,-f],[h,-d],[g,-d],"S",[2*g-i,-f],[2*g+.5,0]],["C",[i,f],[h,d],[g,d],"S",[2*g-i,-f],[2*g-.5,0]]]:[["C",[i,f],[h,d],[g,d],"S",[2*g-i,f],[2*g-.5,0]],["C",[i,-f],[h,-d],[g,-d],"S",[2*g-i,-f],[2*g+.5,0]]];switch(a){case"line":return e.line(k,4*g,this.length);case"arc":return e.arc("photon",l,g,this.length);case"loop":return e.loop("photon",l,g,this.length);default:return e.line(k,4*g,this.length)}},b}(d)},{"./../helpers/Bezier":5,"./../helpers/Klass":7,"./AbstractParticle":12}],16:[function(a,b){{var c=a("./../helpers/Klass"),d=a("./AbstractParticle"),e=a("./../helpers/Bezier");a("./../helpers/Coordinates")}b.exports=function(a){function b(a,c,d,e){b.__super__.constructor.apply(this,[a,c,d]),this.anti=e||!1}c.__extends(b,a),b.prototype.draw=function(a,b,c){var e=this.getPosition(b,c);this.length=e.l;var f=a.group();d(f,this.length,this.color,this.anti),f.path(this.getPath("line")).fill("none").stroke({width:2,color:this.color}),f.transform({cx:e.x,cy:e.y,rotation:e.r,x:e.x,y:e.y})},b.prototype.getPath=function(a){var b=[[1,1],[2,1]],c=1;switch(a){case"line":return e.line(b,c,this.length);case"arc":return e.arc("quark",b,c,this.length);case"loop":return e.loop("quark",b,c,this.length);default:return e.line(b,c,this.length)}};var d=function(a,b,c,d){var e=d?-1:1,f=b/2+7*e,g=0,h=b/2-7*e,i=4,j=b/2-7*e,k=-4,l=""+f+","+g+" "+h+","+i+" "+j+","+k;a.polygon(l).fill(c)};return b}(d)},{"./../helpers/Bezier":5,"./../helpers/Coordinates":6,"./../helpers/Klass":7,"./AbstractParticle":12}]},{},[8]);